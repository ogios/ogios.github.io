import{a as g}from"./axios-4a70c6fc.js";import{E as c}from"./element-plus-db509607.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const h=(e,t)=>{const s=e.__vccOpts||e;for(const[n,r]of t)s[n]=r;return s},l="未知错误，请重试",f=g.create({baseURL:"https://ogios.dns.army",timeout:6e4});f.interceptors.response.use(async e=>{if(console.log("---response---",e),["text/plain"].includes(e.headers["content-type"]))return e;const t=e.data;if(e.status,t.status!==200){t.status===401?c.error("当前为游客或权限过期"):c.error(t.message||l);const s=new Error(t.message||l);return s.code=t.status,Promise.reject(s)}else return t},e=>{var s,n;const t=((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)??l;return c.error(t),e.message=t,Promise.reject(e)});const i=async(e,t={})=>{try{const{successMessage:s,errorMessage:n,originalResponse:r}=t,o=await f(e);return s&&c.success(s),n&&c.error(n),r?await o:(await o).result}catch(s){return Promise.reject(s)}},a="/api/sign";function y(){window.location.href=window.location.origin+"/home"}function d(){const e=localStorage.getItem("token");return e===null?"":e}async function O(){try{const e=d();return await i({url:`${a}/token/checkToken`,method:"GET",headers:{token:e}}),!0}catch{return localStorage.removeItem("userinfo"),!1}}function w(){try{const e=d();return i({url:`${a}/token/userinfo`,method:"GET",headers:{token:e}})}catch(e){return Promise.reject(e)}}function P(e,t){return i({url:`${a}/login`,method:"POST",data:{username:e,password:t}},{successMessage:"登录成功"})}function k(e,t){return i({url:`${a}/register`,method:"POST",data:{username:e,password:t}},{successMessage:"注册成功"})}export{h as _,P as a,k as b,O as c,w as d,y as g,i as r};
