import{f as W,g as u,r as b,al as r,o as A,a as G,E as L,an as O,b as s,c as a,a8 as p,ab as q,ay as J,az as j,N as Q,a3 as X,u as Y}from"./@vue-9c35b395.js";import{_ as Z}from"./TextEditor.vue_vue_type_style_index_0_lang-3005378c.js";import{Q as K}from"./@element-plus-b13bee2d.js";import{C as P}from"./CategorySelector-00e3e5e9.js";import{f as tt,g as et,h as ot,d as nt,i as at}from"./index-4c5ea7d8.js";import{u as it,a as lt}from"./vue-router-7dca9bdd.js";import{E as st}from"./element-plus-db509607.js";import{_ as rt}from"./index-27abbdca.js";import"./@tiptap-05fbaccf.js";import"./prosemirror-state-196a664c.js";import"./prosemirror-model-dd95f3ae.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-8da7cd1c.js";import"./tippy.js-85fd885f.js";import"./@popperjs-38034195.js";import"./prosemirror-view-90e8c06d.js";import"./prosemirror-dropcursor-450722bb.js";import"./prosemirror-gapcursor-b6f07352.js";import"./prosemirror-keymap-f78d9d43.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-history-2c775b3b.js";import"./rope-sequence-5ceeafee.js";import"./prosemirror-tables-cc8976a2.js";import"./prosemirror-commands-19b3babd.js";import"./prosemirror-schema-list-20593f03.js";import"./linkifyjs-32d7b0b9.js";import"./highlight.js-f63ffb7b.js";import"./ant-design-vue-b9441150.js";import"./@babel-aba2881e.js";import"./@ant-design-590e9d8f.js";import"./@ctrl-fb5a5473.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./lodash-es-f35ec05a.js";import"./dayjs-ab63237d.js";import"./vue-types-ef06c517.js";import"./@emotion-f7664732.js";import"./stylis-fad5b415.js";import"./remixicon-0d963432.js";import"./lowlight-dcc438ad.js";import"./fault-884b1697.js";import"./format-0c58afb4.js";import"./BlogStore-0417d5b8.js";import"./pinia-9bc35aa3.js";import"./@vueuse-ffe6a0dc.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-2a4cb2fa.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-7cc3f4ab.js";import"./axios-4a70c6fc.js";const S=_=>(J("data-v-2346c4d0"),_=_(),j(),_),pt={class:"out_page",style:{padding:"1em"}},dt={style:{"margin-top":"3em"}},mt=S(()=>s("h2",{style:{margin:"0"}},"配置",-1)),ct={class:"grid-content"},ut={class:"grid-content"},_t=S(()=>s("label",{slot:"tip",class:"el-upload__tip"},"Head image",-1)),gt={style:{display:"block"}},ft={class:"edit_buttons",style:{"text-align":"center",margin:"2em"}},ht={methods:{},mounted(){},name:"Draft"},yt=W({...ht,setup(_){const k=it(),D=lt(),I=()=>document.documentElement.clientWidth>600?12:24,f=u(I());window.onresize=()=>(()=>{f.value=I()})();const h=200,o=b({id:0,categoryId:1,content:"",headImg:"",isFinished:0,isTop:0,summary:"",title:"",tabs:[]}),d=b([]),n=b({categoryId:1,content:"",createTime:"",headImg:"",id:0,isFinished:0,isTop:0,ownerId:0,ownerName:"",summary:"",tabs:[],title:"",updateTime:"",updateUserId:0}),y=u(""),g=u(),w=u();let v=-1;function U(t,e){var i=null,l=new XMLHttpRequest;l.open("get",t),l.setRequestHeader("Accept","image/png"),l.responseType="blob",l.onload=()=>{i=l.response;let m=new File([i],e,{type:"image/png"});console.log(m),w.value.handleStart(m)},l.onerror=m=>{},l.send()}tt(parseInt(D.params.id)).then(t=>{for(const e in t.blogInfo)n[e]=t.blogInfo[e];et(n.content).then(e=>{console.log("data: ",e.data),y.value=e.data,g.value.updateContent(y.value)}),console.log("blog_content: ",y.value),o.id=n.id,o.title=n.title,o.summary=n.summary,o.tabs=n.tabs,o.content=n.content,o.isTop=n.isTop,o.categoryId=n.categoryId,o.isFinished=n.isFinished,o.headImg=n.headImg,n.headImg&&U(`${window.BASE_IMG_URL}/${n.headImg}`,`headImg.${n.headImg.split(".")[1]}`),v=0});function F(t,e){console.log(e),d.pop(),d.push(e[0].raw),v++}function M(){d.pop()}function R(){return g.value.editor.getHTML()}function x(){return g.value.editor.getText({blockSeparator:`

`})}function T(t,e,i=""){return t.content=e,t.headImg=i,t.summary=t.summary.length===0?x().replace(`
`,"").slice(0,h-5)+(x().length>h?"...":""):t.summary,t}const C=u(0),z=t=>C.value=t;async function B(){let t=JSON.parse(JSON.stringify(o));const e=await ot(R(),n.id);if(d.length*v>0){const i=await nt(d[0]);t=T(t,e.content,i.imageName)}else t=T(t,e.content);console.log(t),at(t).then(i=>{st.success(`文章已更新: ${i.id}`);const l=i.id;console.log("id: ",l),k.push({name:"blogs"})})}return(t,e)=>{const i=r("el-divider"),l=r("el-input"),m=r("el-col"),N=r("el-upload"),E=r("el-row"),V=r("el-icon"),$=r("el-button"),H=r("el-tooltip");return A(),G("div",pt,[L(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=c=>o.title=c),placeholder:"Title",rows:"1"},null,512),[[O,o.title]]),a(Z,{ref_key:"editor",ref:g,editable:!0,content:" ",onMonitorSize:z},null,512),s("div",dt,[a(i,null,{default:p(()=>[Q("配置文件")]),_:1}),mt,a(l,{modelValue:o.summary,"onUpdate:modelValue":e[1]||(e[1]=c=>o.summary=c),maxlength:h,autosize:{minRows:5,maxRows:5},placeholder:"文章总结","show-word-limit":"",type:"textarea"},null,8,["modelValue"]),a(E,{class:"row-bg",justify:"center"},{default:p(()=>[a(m,{span:f.value},{default:p(()=>[s("div",ct,[a(P,{"upload-data":o,"onUpdate:uploadData":e[2]||(e[2]=c=>o=c),style:{display:"inline-block",overflow:"hidden",width:"100%"}},null,8,["upload-data"])])]),_:1},8,["span"]),a(m,{span:f.value.toString()},{default:p(()=>[s("div",ut,[a(N,{ref_key:"upload",ref:w,"auto-upload":!1,class:X({hide:d.length>0}),"file-list":d,multiple:!1,"on-change":F,"on-remove":M,action:"","list-type":"picture-card",style:{display:"inline-block","margin-top":"1em","margin-bottom":"1em"}},{default:p(()=>[_t]),_:1},8,["class","file-list"])])]),_:1},8,["span"])]),_:1})]),s("label",null,"文本大小: "+q(Math.round(C.value/1024/1024*100)/100)+"MB",1),s("div",gt,[s("div",ft,[a(H,{class:"box-item",content:"Upload",effect:"dark",placement:"bottom-start"},{default:p(()=>[a($,{color:"#faebd7",circle:"",style:{border:"1px solid black",width:"5em",height:"5em"},onClick:B},{default:p(()=>[a(V,{size:17},{default:p(()=>[a(Y(K))]),_:1})]),_:1})]),_:1})])])])}}});const fe=rt(yt,[["__scopeId","data-v-2346c4d0"]]);export{fe as default};
